    /**
     * åŠ è½½ä»£ç é«˜äº®ç›¸å…³èµ„æº
     * @returns {Promise} - åŠ è½½å®Œæˆçš„Promise
     */
    loadCodeHighlightResources() {
        logger.info('ğŸ“ åŠ è½½ä»£ç é«˜äº®èµ„æº');
        
        // å°è¯•ä»èµ„æºé…ç½®ä¸­è·å–Prismèµ„æºä¿¡æ¯
        let prismConfig;
        let prismThemeConfig;
        
        try {
            prismConfig = this.resourceConfig.resources.scripts['prism'];
            prismThemeConfig = this.resourceConfig.resources.styles['prism-theme'];
            
            if (!prismConfig) {
                logger.warn('âš ï¸ æœªåœ¨èµ„æºé…ç½®ä¸­æ‰¾åˆ°prismé…ç½®ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼');
            }
        } catch (error) {
            logger.warn('âš ï¸ è·å–Prismèµ„æºé…ç½®å¤±è´¥ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼', error);
        }
        
        // æ£€æŸ¥æ˜¯å¦å·²åŠ è½½ï¼Œä¸å…¶ä»–èµ„æºåŠ è½½å‡½æ•°ä¿æŒä¸€è‡´çš„é£æ ¼
        if (window.prismLoaded && window.Prism) {
            logger.debug('âœ“ Prismå·²åŠ è½½ï¼Œä»…ç¡®ä¿æ ·å¼åŠ è½½å®Œæˆ');
            return this.loadPrismTheme(prismThemeConfig)
                .then(() => {
                    this.applyPrismHighlight();
                    return true;
                })
                .catch(error => {
                    logger.warn('âš ï¸ Prismä¸»é¢˜åŠ è½½å¤±è´¥ï¼Œä½†ç»§ç»­è¿›è¡Œä»£ç é«˜äº®', error);
                    this.applyPrismHighlight();
                    return true;
                });
        }
        
        // å¦‚æœå·²ç»åœ¨åŠ è½½ä¸­ï¼Œé¿å…é‡å¤åŠ è½½
        if (window.prismLoading) {
            logger.debug('â³ Prismæ­£åœ¨åŠ è½½ä¸­ï¼Œç­‰å¾…å®Œæˆ...');
            return this._waitForPrismLoaded(prismThemeConfig);
        }
        
        // æ ‡è®°ä¸ºæ­£åœ¨åŠ è½½
        window.prismLoading = true;
        
        // æŒ‰ç…§æ ‡å‡†æ¨¡å¼åŠ è½½ä¸»è¦èµ„æº
        return Promise.resolve()
            .then(() => {
                logger.info('ğŸ“¦ åŠ è½½Prismæ ¸å¿ƒåº“');
                return this._loadPrismCore(prismConfig);
            })
            .then(coreLoaded => {
                if (!coreLoaded) {
                    logger.error('âŒ Prismæ ¸å¿ƒåº“åŠ è½½å¤±è´¥');
                    window.prismLoading = false;
                    return false;
                }
                // è·å–è¦åŠ è½½çš„è¯­è¨€ç»„ä»¶åˆ—è¡¨
                let languages = ['java', 'javascript', 'cpp', 'python']; // é»˜è®¤è¯­è¨€
                
                // å¦‚æœé…ç½®ä¸­æœ‰å®šä¹‰ç»„ä»¶ï¼Œä½¿ç”¨é…ç½®çš„ç»„ä»¶
                if (prismConfig && prismConfig.source && prismConfig.source.components) {
                    languages = prismConfig.source.components.map(comp => comp.name);
                    logger.debug(`âœ“ ä»é…ç½®è·å–è¯­è¨€ç»„ä»¶åˆ—è¡¨: ${languages.join(', ')}`);
                }
                
                logger.debug('âœ“ Prismæ ¸å¿ƒåº“åŠ è½½æˆåŠŸï¼ŒåŠ è½½è¯­è¨€ç»„ä»¶');
                // å¹¶è¡ŒåŠ è½½è¯­è¨€ç»„ä»¶å’Œä¸»é¢˜
                return Promise.all([
                    this.loadPrismLanguageComponents(languages, prismConfig),
                    this.loadPrismTheme(prismThemeConfig)
                ]);
            })
            .then(results => {
                // æ ‡è®°ä¸ºåŠ è½½å®Œæˆ
                window.prismLoaded = true;
                window.prismLoading = false;
                
                // åº”ç”¨é«˜äº®
                this.applyPrismHighlight();
                
                logger.info('âœ… ä»£ç é«˜äº®èµ„æºåŠ è½½å®Œæˆ');
                return true;
            })
            .catch(error => {
                logger.error('âŒ ä»£ç é«˜äº®èµ„æºåŠ è½½å¤±è´¥', error);
                window.prismLoaded = false;
                window.prismLoading = false;
                return false;
            });
    }

    /**
     * ç­‰å¾…PrismåŠ è½½å®Œæˆ (å†…éƒ¨è¾…åŠ©æ–¹æ³•)
     * @private
     * @param {Object} themeConfig - Prismä¸»é¢˜é…ç½®
     * @returns {Promise} - å®Œæˆçš„Promise
     */
    _waitForPrismLoaded(themeConfig) {
        return new Promise(resolve => {
            const checkInterval = setInterval(() => {
                if (window.prismLoaded && window.Prism) {
                    clearInterval(checkInterval);
                    this.loadPrismTheme(themeConfig)
                        .then(() => {
                            this.applyPrismHighlight();
                            resolve(true);
                        })
                        .catch(() => {
                            this.applyPrismHighlight();
                            resolve(true);
                        });
                }
            }, 100);
            
            // é˜²æ­¢æ— é™ç­‰å¾…
            setTimeout(() => {
                clearInterval(checkInterval);
                if (!window.prismLoaded) {
                    logger.warn('â±ï¸ Prismåº“åŠ è½½è¶…æ—¶');
                    resolve(false);
                }
            }, 5000);
        });
    }

    /**
     * åŠ è½½Prismæ ¸å¿ƒåº“ (å†…éƒ¨è¾…åŠ©æ–¹æ³•)
     * @private
     * @param {Object} config - Prismæ ¸å¿ƒé…ç½®
     * @returns {Promise} - åŠ è½½å®Œæˆçš„Promise
     */
    _loadPrismCore(config) {
        return new Promise(resolve => {
            try {
                // å¦‚æœæœ‰é…ç½®ï¼Œä»é…ç½®è·å–URLï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤URL
                let primaryUrl, fallbackUrls = [], localUrl;
                const version = this.resourceConfig?.versions?.prism || '1.29.0';
                
                // ç¬¬1æ­¥ï¼šé¦–å…ˆå°è¯•ä»é…ç½®è·å–ä¸»URL
                if (config && config.source) {
                    try {
                        const urlResult = this.resourceConfig.getResourceUrl('scripts', 'prism');
                        
                        if (typeof urlResult === 'string') {
                            primaryUrl = urlResult;
                        } else if (urlResult && typeof urlResult.primary === 'string') {
                            primaryUrl = urlResult.primary;
                        } else {
                            logger.warn('âš ï¸ æ— æ³•ä»é…ç½®è·å–æœ‰æ•ˆçš„Prism URL');
                            primaryUrl = null;
                        }
                        
                        // ç¬¬2æ­¥ï¼šå°è¯•è·å–ä¸åŒäºä¸»URLçš„å¤‡ç”¨URL
                        if (config.source.fallbacks && Array.isArray(config.source.fallbacks)) {
                            for (let i = 0; i < config.source.fallbacks.length; i++) {
                                const fbConfig = config.source.fallbacks[i];
                                try {
                                    if (!fbConfig || typeof fbConfig !== 'object') {
                                        continue;
                                    }
                                    
                                    let fallbackUrl;
                                    
                                    // å°è¯•è·å–fallback URL
                                    if (typeof this.resourceConfig.getResourceUrl === 'function' && fbConfig.provider) {
                                        fallbackUrl = this.resourceConfig.getResourceUrl(
                                            'scripts', 'prism', fbConfig.provider
                                        );
                                    } else if (typeof this.resourceConfig.buildUrlFromConfig === 'function') {
                                        fallbackUrl = this.resourceConfig.buildUrlFromConfig(
                                            fbConfig, 'scripts', 'prism'
                                        );
                                    }
                                    
                                    // åªæ·»åŠ æœ‰æ•ˆçš„ä¸”ä¸ä¸»URLä¸åŒçš„å¤‡ç”¨URL
                                    if (typeof fallbackUrl === 'string' && fallbackUrl && fallbackUrl !== primaryUrl) {
                                        fallbackUrls.push(fallbackUrl);
                                    }
                                } catch (e) {
                                    logger.warn(`æ„å»ºPrism fallback URL #${i}å¤±è´¥`, e);
                                }
                            }
                        }
                    } catch (e) {
                        logger.warn('æ„å»ºPrism URLå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼', e);
                        primaryUrl = null;
                        fallbackUrls = [];
                    }
                }
                
                // ç¬¬3æ­¥ï¼šå¦‚æœæœªèƒ½è·å–ä¸»URLæˆ–æœ¬åœ°URLï¼Œä½¿ç”¨é»˜è®¤å€¼
                if (!primaryUrl) {
                    primaryUrl = `https://cdn.jsdelivr.net/npm/prismjs@${version}/prism.min.js`;
                }
                
                // ç¡®ä¿æœ‰å¤‡ç”¨URL
                if (!fallbackUrls.length) {
                    fallbackUrls.push(`https://cdnjs.cloudflare.com/ajax/libs/prism/${version}/prism.min.js`);
                }
                
                // å§‹ç»ˆè®¾ç½®æœ¬åœ°URLä½œä¸ºæœ€ç»ˆå›é€€
                localUrl = '/assets/libs/prism/prism.min.js';
                
                // åˆ›å»ºå’Œæ·»åŠ è„šæœ¬å…ƒç´ 
                const prismScript = document.createElement('script');
                prismScript.src = primaryUrl;
                
                // è®¾ç½®ä¸€ä¸ªæ ‡å¿—ç”¨äºè·Ÿè¸ªPrismæ˜¯å¦åŠ è½½æˆåŠŸ
                window.prismCoreInitialized = false;
                
                // æ£€æŸ¥å‡½æ•° - ç¡®è®¤Prismæ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
                const checkPrismInitialized = () => {
                    if (window.Prism && typeof window.Prism.highlightAll === 'function') {
                        window.prismCoreInitialized = true;
                        return true;
                    }
                    return false;
                };
                
                prismScript.onload = () => {
                    // ç¡®è®¤Prismæ˜¯å¦çœŸæ­£åŠ è½½å¹¶åˆå§‹åŒ–
                    if (checkPrismInitialized()) {
                        logger.debug(`âœ“ Prismæ ¸å¿ƒåº“åŠ è½½æˆåŠŸ (ä» ${prismScript.src})`);
                        resolve(true);
                    } else {
                        // è™½ç„¶è„šæœ¬åŠ è½½äº†ï¼Œä½†Prismå¯¹è±¡æœªæ­£ç¡®åˆå§‹åŒ–
                        logger.warn(`âš ï¸ Prismè„šæœ¬åŠ è½½ä½†æœªæ­£ç¡®åˆå§‹åŒ– (ä» ${prismScript.src})`);
                        
                        // å°è¯•æœ¬åœ°èµ„æºä½œä¸ºå¯é å›é€€
                        prismScript.src = localUrl;
                        
                        prismScript.onload = () => {
                            if (checkPrismInitialized()) {
                                logger.debug(`âœ“ Prismæ ¸å¿ƒåº“ä»æœ¬åœ°åŠ è½½æˆåŠŸ`);
                                resolve(true);
                            } else {
                                logger.error('âŒ Prismæœ¬åœ°èµ„æºæœªèƒ½åˆå§‹åŒ–æ ¸å¿ƒåŠŸèƒ½');
                                resolve(false);
                            }
                        };
                        
                        prismScript.onerror = () => {
                            logger.error('âŒ Prismæœ¬åœ°èµ„æºåŠ è½½å¤±è´¥');
                            resolve(false);
                        };
                    }
                };
                
                // å¤„ç†é”™è¯¯ - å°è¯•å¤‡ç”¨URL
                prismScript.onerror = () => {
                    logger.warn(`âš ï¸ Prismæ ¸å¿ƒåº“åŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æº`);
                    
                    // å¦‚æœæœ‰å¤‡ç”¨URLï¼Œå°è¯•åŠ è½½
                    if (fallbackUrls.length > 0) {
                        const nextUrl = fallbackUrls.shift();
                        prismScript.src = nextUrl;
                        
                        prismScript.onerror = () => {
                            logger.warn(`âš ï¸ Prismå¤‡ç”¨æºåŠ è½½å¤±è´¥ï¼Œå°è¯•æœ¬åœ°èµ„æº`);
                            prismScript.src = localUrl;
                            
                            prismScript.onerror = () => {
                                logger.error('âŒ Prismæ‰€æœ‰åŠ è½½å°è¯•å‡å¤±è´¥');
                                resolve(false);
                            };
                        };
                    } else {
                        // å¦‚æœæ²¡æœ‰å¤‡ç”¨URLï¼Œç›´æ¥å°è¯•æœ¬åœ°èµ„æº
                        logger.warn('âš ï¸ æ— Prismå¤‡ç”¨URL, å°è¯•æœ¬åœ°èµ„æº');
                        prismScript.src = localUrl;
                        
                        prismScript.onerror = () => {
                            logger.error('âŒ Prismæ‰€æœ‰åŠ è½½å°è¯•å‡å¤±è´¥');
                            resolve(false);
                        };
                    }
                };
                
                document.head.appendChild(prismScript);
                
                // æ·»åŠ è¶…æ—¶ä¿æŠ¤
                setTimeout(() => {
                    if (!window.prismCoreInitialized) {
                        logger.warn('â±ï¸ Prismæ ¸å¿ƒåŠ è½½è¶…æ—¶ï¼Œå°è¯•æœ¬åœ°èµ„æº');
                        
                        // ç§»é™¤ä¹‹å‰çš„è„šæœ¬å…ƒç´ 
                        if (prismScript.parentNode) {
                            prismScript.parentNode.removeChild(prismScript);
                        }
                        
                        // åˆ›å»ºæ–°çš„è„šæœ¬å…ƒç´ ï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°èµ„æº
                        const localScript = document.createElement('script');
                        localScript.src = localUrl;
                        
                        localScript.onload = () => {
                            if (checkPrismInitialized()) {
                                logger.debug(`âœ“ Prismæ ¸å¿ƒåº“ä»æœ¬åœ°è¶…æ—¶å›é€€åŠ è½½æˆåŠŸ`);
                                resolve(true);
                            } else {
                                logger.error('âŒ Prismæœ¬åœ°èµ„æºåŠ è½½æˆåŠŸä½†åˆå§‹åŒ–å¤±è´¥');
                                resolve(false);
                            }
                        };
                        
                        localScript.onerror = () => {
                            logger.error('âŒ Prismæœ¬åœ°èµ„æºåŠ è½½å¤±è´¥');
                            resolve(false);
                        };
                        
                        document.head.appendChild(localScript);
                    }
                }, 5000);
            } catch (error) {
                logger.error('âŒ åŠ è½½Prismæ—¶å‡ºé”™', error);
                resolve(false);
            }
        });
    }

    /**
     * åŠ è½½Prismè¯­è¨€ç»„ä»¶
     * @param {Array<string>} languages - è¦åŠ è½½çš„è¯­è¨€åˆ—è¡¨
     * @param {Object} config - é…ç½®å¯¹è±¡
     * @returns {Promise} - åŠ è½½å®Œæˆçš„Promise
     */
    loadPrismLanguageComponents(languages, config) {
        // ç¡®ä¿languagesæ˜¯æœ‰æ•ˆæ•°ç»„
        if (!languages || !Array.isArray(languages) || languages.length === 0) {
            logger.debug('æ²¡æœ‰æŒ‡å®šè¦åŠ è½½çš„Prismè¯­è¨€ç»„ä»¶');
            return Promise.resolve(true);
        }
        
        // è®°å½•åˆå§‹è¯·æ±‚çš„è¯­è¨€æ•°é‡
        const originalCount = languages.length;
        logger.debug(`å‡†å¤‡åŠ è½½${originalCount}ä¸ªPrismè¯­è¨€ç»„ä»¶: ${languages.join(', ')}`);
        
        // ç¡®ä¿è¯­è¨€æ•°ç»„æœ‰æ•ˆ
        const validLanguages = languages.filter(lang => typeof lang === 'string' && lang.trim());
        if (validLanguages.length === 0) {
            logger.warn('æ²¡æœ‰æœ‰æ•ˆçš„Prismè¯­è¨€ç»„ä»¶');
            return Promise.resolve(true);
        }
        
        // å¤„ç†è¯­è¨€ä¾èµ–å…³ç³»
        const allLanguages = [...validLanguages];
        // è·Ÿè¸ªç»„ä»¶çš„å¤„ç†çŠ¶æ€
        const processedComponents = new Map();
        
        // ä¾èµ–å…³ç³»æ˜ å°„ - ä¸ºç¡®ä¿ç»„ä»¶æŒ‰æ­£ç¡®é¡ºåºåŠ è½½
        const dependencyMap = {
            'cpp': ['c'],           // C++ä¾èµ–äºC
            'java-extras': ['java'],
            'php-extras': ['php'],
            'jsx': ['javascript'],
            'tsx': ['jsx', 'typescript'],
            'scala': ['java']
        };
        
        // æ·»åŠ æ‰€æœ‰ä¾èµ–è¯­è¨€å¹¶è®°å½•çŠ¶æ€
        validLanguages.forEach(lang => {
            const langId = lang.toLowerCase().trim();
            processedComponents.set(langId, { requested: true, loaded: false });
            
            if (dependencyMap[langId]) {
                dependencyMap[langId].forEach(depLang => {
                    if (!allLanguages.includes(depLang)) {
                        allLanguages.push(depLang);
                        // æ ‡è®°ä¸ºä¾èµ–æ·»åŠ ï¼Œè€Œéç›´æ¥è¯·æ±‚
                        processedComponents.set(depLang, { requested: false, loaded: false });
                        logger.debug(`æ·»åŠ  ${langId} çš„ä¾èµ–è¯­è¨€: ${depLang}`);
                    }
                });
            }
        });
        
        // ç›´æ¥ä½¿ç”¨æœ¬åœ°è·¯å¾„ä½œä¸ºåŸºæœ¬è·¯å¾„
        const basePath = '/assets/libs/prism/components/';
        
        // å°†è¯­è¨€æŒ‰ä¾èµ–å…³ç³»åˆ†ç»„
        const baseLangs = []; // ä½œä¸ºä¾èµ–çš„åŸºç¡€è¯­è¨€
        const dependentLangs = []; // ä¾èµ–å…¶ä»–è¯­è¨€çš„è¯­è¨€
        const normalLangs = []; // æ²¡æœ‰ä¾èµ–å…³ç³»çš„è¯­è¨€
        
        allLanguages.forEach(lang => {
            const langId = lang.toLowerCase().trim();
            
            // åˆ¤æ–­æ­¤è¯­è¨€æ˜¯å¦æ˜¯å…¶ä»–è¯­è¨€çš„ä¾èµ–
            const isBaseLang = Object.values(dependencyMap).some(deps => 
                deps.includes(langId)
            );
            
            // åˆ¤æ–­æ­¤è¯­è¨€æ˜¯å¦ä¾èµ–å…¶ä»–è¯­è¨€
            const isDependentLang = dependencyMap[langId] && dependencyMap[langId].length > 0;
            
            if (isBaseLang) {
                baseLangs.push(langId);
            } else if (isDependentLang) {
                dependentLangs.push(langId);
            } else {
                normalLangs.push(langId);
            }
        });
        
        if (baseLangs.length > 0) {
            logger.debug(`åŸºç¡€è¯­è¨€(${baseLangs.length}ä¸ª): ${baseLangs.join(', ')}`);
        }
        if (dependentLangs.length > 0) {
            logger.debug(`ä¾èµ–å‹è¯­è¨€(${dependentLangs.length}ä¸ª): ${dependentLangs.join(', ')}`);
        }
        if (normalLangs.length > 0) {
            logger.debug(`æ™®é€šè¯­è¨€(${normalLangs.length}ä¸ª): ${normalLangs.join(', ')}`);
        }
        
        // åŠ è½½å•ä¸ªè¯­è¨€ç»„ä»¶çš„å‡½æ•°
        const loadLanguage = (langId) => {
            return new Promise(resolve => {
                // å·²ç»åŠ è½½è¿‡è¿™ä¸ªç»„ä»¶åˆ™è·³è¿‡
                if (window.Prism && window.Prism.languages && window.Prism.languages[langId]) {
                    logger.debug(`Prismè¯­è¨€ç»„ä»¶ ${langId} å·²åŠ è½½`);
                    // æ›´æ–°çŠ¶æ€
                    if (processedComponents.has(langId)) {
                        processedComponents.get(langId).loaded = true;
                    }
                    return resolve({ loaded: true, skipped: true, langId });
                }
                
                // JavaScriptä½œä¸ºPrismæ ¸å¿ƒçš„ä¸€éƒ¨åˆ†å¯èƒ½å·²ç»åŠ è½½
                if ((langId === 'javascript' || langId === 'js') && 
                    window.Prism && window.Prism.languages && window.Prism.languages.javascript) {
                    logger.debug(`Prismæ ¸å¿ƒå·²åŒ…å« ${langId} è¯­è¨€æ”¯æŒ`);
                    // æ›´æ–°çŠ¶æ€
                    if (processedComponents.has(langId)) {
                        processedComponents.get(langId).loaded = true;
                    }
                    return resolve({ loaded: true, skipped: true, langId });
                }
                
                // åˆ›å»ºè„šæœ¬å…ƒç´ 
                const script = document.createElement('script');
                script.type = 'text/javascript';
                
                // ä½¿ç”¨æœ¬åœ°è·¯å¾„
                script.src = `${basePath}prism-${langId}.min.js`;
                
                script.onload = () => {
                    // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿ç»„ä»¶æœ‰æ—¶é—´åˆå§‹åŒ–
                    setTimeout(() => {
                        if (window.Prism && window.Prism.languages && window.Prism.languages[langId]) {
                            logger.info(`âœ“ Prism ${langId} è¯­è¨€ç»„ä»¶åŠ è½½æˆåŠŸ`);
                            // æ›´æ–°çŠ¶æ€
                            if (processedComponents.has(langId)) {
                                processedComponents.get(langId).loaded = true;
                            }
                            resolve({ loaded: true, skipped: false, langId });
                        } else {
                            logger.warn(`âš ï¸ Prism ${langId} ç»„ä»¶å·²åŠ è½½ä½†æœªæ­£ç¡®åˆå§‹åŒ–`);
                            resolve({ loaded: false, skipped: false, langId });
                        }
                    }, 50); // çŸ­æš‚å»¶è¿Ÿç¡®ä¿åˆå§‹åŒ–
                };
                
                script.onerror = () => {
                    logger.error(`âŒ æ— æ³•åŠ è½½Prism ${langId} è¯­è¨€ç»„ä»¶`);
                    resolve({ loaded: false, skipped: false, langId });
                };
                
                document.head.appendChild(script);
            });
        };
        
        // åˆ†ä¸‰æ­¥åŠ è½½
        return Promise.resolve()
            // æ­¥éª¤1: åŠ è½½åŸºç¡€è¯­è¨€
            .then(() => {
                return Promise.all(baseLangs.map(loadLanguage));
            })
            // æ­¥éª¤2: çŸ­æš‚å»¶è¿ŸååŠ è½½ä¾èµ–å‹è¯­è¨€
            .then((baseResults) => {
                if (dependentLangs.length === 0) return baseResults;
                
                // å…³é”®ï¼šåœ¨åŠ è½½ä¾èµ–å‹è¯­è¨€å‰æ·»åŠ å»¶è¿Ÿï¼Œç¡®ä¿åŸºç¡€è¯­è¨€ç»„ä»¶å®Œå…¨åˆå§‹åŒ–
                return new Promise(resolve => {
                    setTimeout(() => {
                        // ç¡®è®¤åŸºç¡€è¯­è¨€æ˜¯å¦éƒ½å·²æ­£ç¡®åˆå§‹åŒ–
                        const baseInitialized = baseLangs.every(lang => 
                            window.Prism && window.Prism.languages && window.Prism.languages[lang]
                        );
                        
                        if (!baseInitialized) {
                            logger.warn('æŸäº›åŸºç¡€è¯­è¨€ç»„ä»¶æœªæ­£ç¡®åˆå§‹åŒ–ï¼Œå¯èƒ½å½±å“ä¾èµ–å‹è¯­è¨€');
                        }
                        
                        Promise.all(dependentLangs.map(loadLanguage))
                            .then(depResults => {
                                resolve([...baseResults, ...depResults]);
                            });
                    }, 200); // å»¶è¿Ÿ200æ¯«ç§’ç¡®ä¿åŸºç¡€è¯­è¨€ç»„ä»¶å®Œå…¨åˆå§‹åŒ–
                });
            })
            // æ­¥éª¤3: åŠ è½½æ™®é€šè¯­è¨€
            .then(previousResults => {
                return Promise.all(normalLangs.map(loadLanguage))
                    .then(normResults => [...previousResults, ...normResults]);
            })
            // å¤„ç†ç»“æœ
            .then(allResults => {
                // è®¡ç®—åŸå§‹è¯·æ±‚çš„ç»„ä»¶ä¸­æˆåŠŸåŠ è½½çš„æ•°é‡
                const requestedComponents = Array.from(processedComponents.entries())
                    .filter(([_, status]) => status.requested);
                
                const loadedRequestedCount = requestedComponents
                    .filter(([_, status]) => status.loaded)
                    .length;
                
                // è®¡ç®—æ‰€æœ‰ç»„ä»¶çš„åŠ è½½æƒ…å†µ
                const totalSuccessCount = allResults.filter(r => r.loaded).length;
                const loadedDependenciesCount = totalSuccessCount - loadedRequestedCount;
                
                // è¾“å‡ºç®€æ˜çš„æ—¥å¿—
                logger.info(`åŠ è½½äº† ${loadedRequestedCount}/${originalCount} ä¸ªè¯·æ±‚çš„Prismè¯­è¨€ç»„ä»¶` + 
                          (loadedDependenciesCount > 0 ? `ï¼Œä»¥åŠ ${loadedDependenciesCount} ä¸ªä¾èµ–ç»„ä»¶` : ''));
                
                // ä¸»åŠ¨è§¦å‘é«˜äº®
                this.applyPrismHighlight();
                
                return totalSuccessCount > 0;
            })
            .catch(err => {
                logger.error('åŠ è½½Prismè¯­è¨€ç»„ä»¶æ—¶å‡ºé”™', err);
                return false;
            });
    }

    /**
     * åŠ è½½Prismè¯­æ³•é«˜äº®ä¸»é¢˜
     * @param {Object} themeConfig - ä¸»é¢˜é…ç½®
     * @returns {Promise} - åŠ è½½å®Œæˆçš„Promise
     */
    loadPrismTheme(themeConfig) {
        // æ·»åŠ ä¸»é¢˜åŠ è½½çŠ¶æ€è·Ÿè¸ªï¼Œé¿å…é‡å¤åŠ è½½
        if (window.prismThemeLoaded === true) {
            logger.debug('Prismä¸»é¢˜å·²åŠ è½½ï¼Œè·³è¿‡');
            return Promise.resolve(true);
        }

        // æ ‡è®°æ­£åœ¨åŠ è½½ä¸­
        if (window.prismThemeLoading !== true) {
            window.prismThemeLoading = true;
        } else {
            logger.debug('Prismä¸»é¢˜æ­£åœ¨åŠ è½½ä¸­ï¼Œç­‰å¾…å®Œæˆ');
            return new Promise(resolve => {
                const checkInterval = setInterval(() => {
                    if (window.prismThemeLoaded === true) {
                        clearInterval(checkInterval);
                        resolve(true);
                    }
                }, 100);
                
                setTimeout(() => {
                    clearInterval(checkInterval);
                    resolve(false);
                }, 5000);
            });
        }

        try {
            let themeUrl, fallbackUrls = [], localUrl;
            
            // å¦‚æœæœ‰ä¸»é¢˜é…ç½®ï¼Œä»é…ç½®è·å–URL
            if (themeConfig && themeConfig.source) {
                try {
                    // ä»é…ç½®è·å–ä¸»URL
                    const urlResult = this.resourceConfig.getResourceUrl('styles', 'prism-theme');
                    
                    // ç¡®ä¿URLæ˜¯å­—ç¬¦ä¸²
                    if (typeof urlResult === 'string') {
                        themeUrl = urlResult;
                    } else if (urlResult && typeof urlResult.primary === 'string') {
                        themeUrl = urlResult.primary;
                        
                        if (Array.isArray(urlResult.fallbacks)) {
                            fallbackUrls = urlResult.fallbacks.filter(url => typeof url === 'string');
                        }
                    } else {
                        logger.warn('âš ï¸ æ— æ³•ä»é…ç½®è·å–æœ‰æ•ˆçš„Prismä¸»é¢˜URL');
                        themeUrl = null;
                    }
                    
                    // è·å–æœ¬åœ°URL
                    if (themeConfig.attributes && themeConfig.attributes['data-local-fallback']) {
                        localUrl = themeConfig.attributes['data-local-fallback'];
                    }
                    
                    if (themeUrl) {
                        logger.debug(`ä½¿ç”¨é…ç½®çš„Prismä¸»é¢˜: ${themeUrl}`);
                    }
                } catch (e) {
                    logger.warn('ä»é…ç½®æ„å»ºPrismä¸»é¢˜URLå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼', e);
                    themeUrl = null;
                }
            }
            
            // å¦‚æœæ— æ³•ä»é…ç½®è·å–URLï¼Œä½¿ç”¨é»˜è®¤å€¼
            if (!themeUrl) {
                const version = this.resourceConfig.versions?.prism || '1.29.0';
                themeUrl = `https://cdn.jsdelivr.net/npm/prismjs@${version}/themes/prism-tomorrow.min.css`;
                fallbackUrls = [
                    `https://cdnjs.cloudflare.com/ajax/libs/prism/${version}/themes/prism-tomorrow.min.css`
                ];
                localUrl = `/assets/libs/prism/themes/prism-tomorrow.min.css`;
                logger.debug(`ä½¿ç”¨é»˜è®¤Prismä¸»é¢˜URL: ${themeUrl}`);
            }
            
            // æ„å»ºé€‰é¡¹å¯¹è±¡
            const options = {};
            if (fallbackUrls && fallbackUrls.length > 0) {
                options.fallbacks = fallbackUrls;
            }
            if (localUrl) {
                options.localFallback = localUrl;
            }
            
            // å…³é”®ä¿®å¤ï¼šç¡®ä¿è¿”å›Promise
            const loadPromise = styleResourceLoader.loadCssNonBlocking(themeUrl, options);
            
            // å¦‚æœloadCssNonBlockingæ²¡æœ‰è¿”å›Promiseï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Promise
            if (!loadPromise || typeof loadPromise.then !== 'function') {
                logger.debug('loadCssNonBlockingæœªè¿”å›Promiseï¼Œåˆ›å»ºæ–°Promise');
                
                // è®¾ç½®çŠ¶æ€æ ‡è®°
                window.prismThemeLoaded = true;
                window.prismThemeLoading = false;
                
                return Promise.resolve(true);
            }
            
            // æ­£å¸¸å¤„ç†Promise
            return loadPromise
                .then(result => {
                    window.prismThemeLoaded = true;
                    window.prismThemeLoading = false;
                    return result;
                })
                .catch(error => {
                    logger.error('âŒ Prismä¸»é¢˜åŠ è½½å¤±è´¥', error);
                    window.prismThemeLoaded = false;
                    window.prismThemeLoading = false;
                    return false;
                });
        } catch (error) {
            logger.error('âŒ åŠ è½½Prismä¸»é¢˜æ—¶å‘ç”Ÿé”™è¯¯:', error);
            window.prismThemeLoaded = false;
            window.prismThemeLoading = false;
            return Promise.resolve(false);
        }
    }

    /**
     * åº”ç”¨Prismé«˜äº® (å†…éƒ¨æ–¹æ³•)
     * @private
     */
    applyPrismHighlight() {
        // å»¶è¿Ÿé«˜äº®å¤„ç†ï¼Œç¡®ä¿DOMå·²å®Œå…¨åŠ è½½
        if (window.Prism) {
            setTimeout(() => {
                if (typeof window.Prism.highlightAll === 'function') {
                    try {
                        window.Prism.highlightAll();
                    } catch (e) {
                        logger.warn('Prismå…¨å±€é«˜äº®å¤„ç†å¤±è´¥', e);
                    }
                }
                
                // å¤„ç†æ ‡è®°ä¸ºç­‰å¾…é«˜äº®çš„ä»£ç å—
                document.querySelectorAll('.waiting-for-highlight').forEach(block => {
                    const codeElement = block.querySelector('code');
                    if (codeElement && typeof window.Prism.highlightElement === 'function') {
                        try {
                            window.Prism.highlightElement(codeElement);
                            block.classList.remove('waiting-for-highlight');
                            codeElement.classList.remove('no-highlight');
                        } catch (e) {
                            logger.warn('ä»£ç å—é«˜äº®å¤„ç†å¤±è´¥', e);
                        }
                    }
                });
            }, 200);
        }
    }